<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Crime Statistics Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <style>
        body { font-family: Arial; display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; text-align: center; }
        .chart-container { width: 400px; margin: 10px; }
        .chart-label { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="abs-trend-rape">
    </div>
    <div class="pc-trend-rape">
    </div>

    <script>
        const csvData = {
            "rape": `Year,Reported,FRF,Mistake/Civil,Convicted
2016,38947,2839,249,4739
2017,32559,2556,746,5822
2018,33356,2875,767,4708
2019,32033,3652,622,4640
2020,28046,3375,571,3814
2021,31677,4009,819,3368
2022,31516,4340,1130,5067`,

            "attempted_rape": `Year,Reported,FRF,Mistake/Civil,Convicted
2016,5729,503,29,215
2017,4154,463,153,279
2018,4097,493,147,266
2019,3944,718,96,317
2020,3741,631,90,221
2021,3800,730,196,158
2022,3288,760,175,192`,

            "sexual_assault": `Year,Reported,FRF,Mistake/Civil,Convicted
2016,84746,4645,1088,7001
2017,86001,4748,1918,8955
2018,89097,5257,2450,9352
2019,88367,6288,2378,8811
2020,85392,5821,2317,5629
2021,89200,6764,3625,6502
2022,83344,6821,2674,8056`,

            "cruelty": `Year,Reported,FRF,Mistake/Civil,Convicted
2016,110378,6745,2958,5433
2017,104551,4931,5385,6777
2018,103272,4950,5743,4982
2019,125298,7606,6939,5945
2020,111549,5520,4832,3425
2021,136234,6938,7037,4315
2022,140019,7076,8093,8307`,

            "sexual_insult": `Year,Reported,FRF,Mistake/Civil,Convicted
2016,7305,400,110,735
2017,7451,306,128,688
2018,6992,339,237,515
2019,6939,425,178,498
2020,7065,314,134,286
2021,7788,361,170,253
2022,8972,449,368,524`
        };

        function parseCSV(csv) {
            const rows = csv.split('\n').slice(1);
            return rows.map(row => row.split(',').map(Number));
        }

        function createAreaGraph(chartId, data) {
            const container = document.querySelector('div.abs-trend-' + chartId);
            const ctx = document.createElement('canvas');
            ctx.width = 500;
            ctx.height = 300;
            container.appendChild(ctx);

            const years = data.map(row => row[0]);
            const frf = data.map(row => row[2]);
            const falseCases = data.map(row => row[2] + row[3]);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Total False',
                        data: falseCases,
                        backgroundColor: 'rgba(255,0,0,0.5)',
                        borderColor: 'rgba(255,50,50,1)',
                        fill: true
                    }, {
                        label: 'Confirmed Malicious',
                        data: frf,
                        backgroundColor: 'rgba(255,40,40,0.6)',
                        borderColor: 'rgba(255,0,0,1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index', // Show values of all datasets for the hovered index
                        intersect: false
                    },
                    scales: {
                        x: {
                            ticks: {
                                font: {
                                    weight: 'semi-bold'
                                },
                                color: '#000'
                            }
                        },
                        y: {
                            ticks: {
                                font: {
                                    weight: 'semi-bold'
                                },
                                color: '#000'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw;
                                    return `${label}: ${value}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createPercentageAreaGraph(chartId, data) {
            const container = document.querySelector('div.pc-trend-' + chartId);
            const ctx = document.createElement('canvas');
            ctx.width = 500;
            ctx.height = 300;
            container.appendChild(ctx);

            const years = data.map(row => row[0]);
            const falseCasesPercentage = data.map(row => ((row[2] + row[3]) / (row[2] + row[3] + row[4])) * 100);
            const maliciousIntentPercentage = data.map(row => (row[2] / (row[2] + row[3] + row[4])) * 100);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Total False',
                        data: falseCasesPercentage,
                        backgroundColor: 'rgba(255,0,0,0.5)',
                        borderColor: 'rgba(255,50,50,1)',
                        fill: true
                    }, {
                        label: 'Confirmed Malicious',
                        data: maliciousIntentPercentage,
                        backgroundColor: 'rgba(255,40,40,0.6)',
                        borderColor: 'rgba(255,0,0,1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            ticks: {
                                font: {
                                    weight: 'semi-bold'
                                },
                                color: '#000'
                            }
                        },
                        y: {
                            ticks: {
                                font: {
                                    weight: 'semi-bold'
                                },
                                color: '#000'
                            }
                        }
                    },
                    interaction: {
                        mode: 'index', // Show values of all datasets for the hovered index
                        intersect: false
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw.toFixed(2); // For percentages
                                    return `${label}: ${value}%`;
                                }
                            }
                        }
                    }
                }
            });
        }


        Object.entries(csvData).forEach(([key, value]) => {
            const parsedData = parseCSV(value);
            const data2022 = parsedData[parsedData.length - 1];
            
            createAreaGraph(key, parsedData);
            createPercentageAreaGraph(key, parsedData);
        });
    </script>
</body>
</html>